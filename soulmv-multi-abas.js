/* SoulMV Multi-Abas - versão GitHub
   Carrega o painel principal, configura abas por andar (CO/NIR/MATE),
   e adiciona botão flutuante com CONFIGURAÇÕES + SALVAR + ABRIR ABAS.
*/

(function(){if(!location.href.includes('/soul-mv')){alert('Este botão só funciona dentro do SoulMV.');return;}if(document.getElementById('mv-multi-painel'))return;const d=ms=>new Promise(r=>setTimeout(r,ms));function f(s,t){const a=Array.from(s.querySelectorAll('li.menu-node > a[role="menuitem"]'));return a.find(x=>(x.title||x.textContent.trim())===t)||null;}async function ex(s,t){const l=f(s,t);if(!l)return null;const li=l.closest('li.menu-node');if(!li)return null;if(!li.classList.contains('open')){l.click();await d(600);}return li.querySelector('ul')||li;}function hasTab(k){const tabs=Array.from(document.querySelectorAll('.workspace-tab-bar .tab-item-text'));return tabs.some(t=>{const txt=(t.title||t.textContent||'');return txt.indexOf(k)!==-1;});}async function waitTabReady(k){if(!k)return;for(let i=0;i<25;i++){if(hasTab(k))return;await d(200);}}async function ensureLoaded(target,openFn){let sawLoading=false;for(let i=0;i<25;i++){const tabs=Array.from(document.querySelectorAll('.workspace-tab-bar .tab-item-text'));const targetTab=tabs.find(t=>{const txt=(t.title||t.textContent||'');return txt.indexOf(target)!==-1;});if(targetTab)return;const loadingTab=tabs.find(t=>/Carregando/i.test(t.textContent||''));if(loadingTab)sawLoading=true;await d(200);}if(sawLoading&&typeof openFn==='function'){openFn();}}const state={painel:true,transf:true,aviso:true,atend:true,ficha:true,desc:true,conf:true,transfCC:true,movAtend:true,altaHosp:true};const searchKeys={painel:'Painel da Internação',transf:'Transferência de Paciente',aviso:'Aviso de Cirurgia',atend:'Atendimentos',ficha:'Ficha Obstétrica',desc:'Descrição Cirúrgica',conf:'Confirmação de Cirurgia',transfCC:'Transferência para Centro Cirúrgico',movAtend:'Movimentação do Atendimento',altaHosp:'Alta Hospitalar'};async function oPainel(){if(!state.painel||hasTab(searchKeys.painel))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Internação');if(!s)return;s=await ex(s,'Atendimento');if(!s)return;const l=Array.from(s.querySelectorAll('a[role="menuitem"]')).find(a=>(a.title||a.textContent.trim())==='Painel da Internação');if(l)l.click();}async function oTransf(){if(!state.transf||hasTab(searchKeys.transf))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Internação');if(!s)return;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Transferência de Paciente');if(!s)return;const l=Array.from(s.querySelectorAll('a[role="menuitem"]')).find(a=>(a.title||a.textContent.trim())==='Transferência de Leito');if(l)l.click();}async function oAviso(){if(!state.aviso||hasTab(searchKeys.aviso))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Centro Cirúrgico e Obstétrico');if(!s)return;s=await ex(s,'Centro Cirúrgico');if(!s)return;const l=Array.from(s.querySelectorAll('a[role="menuitem"]')).find(a=>(a.title||a.textContent.trim())==='Aviso de Cirurgia');if(l)l.click();}async function oAtend(){if(!state.atend||hasTab(searchKeys.atend))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Internação');if(!s)return;s=await ex(s,'Consultas');if(!s)return;const l=Array.from(s.querySelectorAll('a[role="menuitem"]')).find(a=>(a.title||a.textContent.trim())==='Atendimentos');if(l)l.click();}async function oFicha(){if(!state.ficha||hasTab(searchKeys.ficha))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Centro Cirúrgico e Obstétrico');if(!s)return;s=await ex(s,'Centro Cirúrgico');if(!s)return;const l=Array.from(s.querySelectorAll('a[role="menuitem"]')).find(a=>(a.title||a.textContent.trim())==='Ficha Obstétrica');if(l)l.click();}async function oDesc(){if(!state.desc||hasTab(searchKeys.desc))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Centro Cirúrgico e Obstétrico');if(!s)return;s=await ex(s,'Centro Cirúrgico');if(!s)return;const l=Array.from(s.querySelectorAll('a[role="menuitem"]')).find(a=>(a.title||a.textContent.trim())==='Descrição Cirúrgica');if(l)l.click();}async function oConf(){if(!state.conf||hasTab(searchKeys.conf))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Centro Cirúrgico e Obstétrico');if(!s)return;s=await ex(s,'Centro Cirúrgico');if(!s)return;const l=Array.from(s.querySelectorAll('a[role="menuitem"]')).find(a=>(a.title||a.textContent.trim())==='Confirmação da Cirurgia');if(l)l.click();}async function oTransfCC(){if(!state.transfCC||hasTab(searchKeys.transfCC))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Centro Cirúrgico e Obstétrico');if(!s)return;s=await ex(s,'Centro Cirúrgico');if(!s)return;s=await ex(s,'Transferência de Paciente');if(!s)return;const l=Array.from(s.querySelectorAll('a[role="menuitem"]')).find(a=>(a.title||a.textContent.trim())==='Transferência para Centro Cirúrgico');if(l)l.click();}async function oMovAtend(){if(!state.movAtend||hasTab(searchKeys.movAtend))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)return;s=await ex(s,'Internação');if(!s)return;s=await ex(s,'Consultas');if(!s)return;const l=Array.from(s.querySelectorAll('a[role="menuitem"]')).find(a=>(a.title||a.textContent.trim())==='Movimentação do Atendimento');if(l)l.click();}async function oAltaHosp(){if(!state.altaHosp||hasTab(searchKeys.altaHosp))return;let s=document.querySelector('#workspace-menubar ul.nav')||document;s=await ex(s,'Atendimento');if(!s)retur
